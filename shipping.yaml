---
- name: setup shipping
  hosts: shipping.devops-project.co.uk
  become: yes

  tasks:
   - name: install maven
     ansible.builtin.package:
       name: maven
       state: present

   - name: craete user
     ansible.builtin.user:
       name: roboshop
       state: present
       system: true
       comment: sys user
       home: /app
       shell: /sbin/nologin

   - name: craete folder
     ansible.builtin.file:
       path: /app
       state: directory

   - name: download code
     ansible.builtin.get_url:
       url: "https://roboshop-artifacts.s3.amazonaws.com/shipping-v3.zip"
       dest: /tmp/shipping.zip

   - name: unzip code
     ansible.builtin.copy:
       src: /tmp/shipping.zip
       dest: /app

   - name: install dependecies
     ansible.builtin.command: mvn clean package
     args:
       chdir: /app

   - name: rename file
     ansible.builtin.command: mv target/shipping-1.0.jar shipping.jar

   - name: craete systemd service
     ansible.builtin.copy:
       src: shipping.service
       dest: /etc/systemd/system/shipping.service

   #- name: install mysql
     #ansible.builtin.package:
       #name: mysql
       #state: present

    